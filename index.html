<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/android-icon-192x192.png">
    <link href="http://fonts.googleapis.com/css?family=Poiret+One" rel="stylesheet">
    <title>protoo</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/versatica/protoo'>Source Code at GitHub</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="protoo">prot<span class="double-o">oo</span></h1>

<p><em>Documentation for v4</em></p>

<p><strong>protoo</strong> is a minimalist and extensible Node.js signaling framework for multi-party Real-Time Communication applications.</p>

<p>It provides both a server side Node.js module and a client side JavaScript library. Its primary purpose is to provide applications with the ability to easily add group chat, presence and multi-party multimedia capabilities.</p>

<h2 id="messages">Messages</h2>

<p><strong>protoo</strong> defines a signaling protocol based on JSON requests, responses and notifications. It is up to the application to define and extend the signaling protocol and the content of those messages in order to accomplish the desired feature set.</p>

<h3 id="request">Request</h3>

<p>A <strong>protoo</strong> request is a JSON message.</p>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="nl">request</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">id</span>      <span class="p">:</span> <span class="mi">12345678</span><span class="p">,</span>
  <span class="nx">method</span>  <span class="p">:</span> <span class="s1">'chatmessage'</span><span class="p">,</span>
  <span class="nx">data</span>    <span class="p">:</span>
  <span class="p">{</span>
    <span class="nl">type</span>  <span class="p">:</span> <span class="s1">'text'</span><span class="p">,</span>
    <span class="nx">value</span> <span class="p">:</span> <span class="s1">'Hi there!'</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>request</td>
<td>Must be <code class="prettyprint">true</code>.</td>
</tr>
<tr>
<td>id</td>
<td>A number identifier to match its associated response.</td>
</tr>
<tr>
<td>method</td>
<td>A custom string representing the request method.</td>
</tr>
<tr>
<td>data</td>
<td>An object with custom data.</td>
</tr>
</tbody></table>

<h3 id="response">Response</h3>

<p>A <strong>protoo</strong> response is a JSON message associated to a <strong>protoo</strong> request.</p>

<blockquote>
<p>Success response</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="nl">response</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">id</span>       <span class="p">:</span> <span class="mi">12345678</span><span class="p">,</span>
  <span class="nx">ok</span>       <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">data</span>     <span class="p">:</span>
  <span class="p">{</span>
    <span class="nl">foo</span> <span class="p">:</span> <span class="s1">'lalala'</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Error response</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="nl">response</span>    <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">id</span>          <span class="p">:</span> <span class="mi">12345678</span><span class="p">,</span>
  <span class="nx">ok</span>          <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="nx">errorCode</span>   <span class="p">:</span> <span class="mi">123</span><span class="p">,</span>
  <span class="nx">errorReason</span> <span class="p">:</span> <span class="s1">'Something failed'</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>response</td>
<td>Must be <code class="prettyprint">true</code>.</td>
</tr>
<tr>
<td>id</td>
<td>A number identifier matching its associated request.</td>
</tr>
<tr>
<td>ok</td>
<td><code class="prettyprint">true</code> if a success response, <code class="prettyprint">false</code> otherwise.</td>
</tr>
<tr>
<td>data</td>
<td>An object with custom data (just for success responses).</td>
</tr>
<tr>
<td>errorCode</td>
<td>Numeric error code up to the application (just for error responses).</td>
</tr>
<tr>
<td>errorReason</td>
<td>Descriptive error text up to the application (just for error responses).</td>
</tr>
</tbody></table>

<h3 id="notification">Notification</h3>

<p>A <strong>protoo</strong> notification is a JSON message (so there is no associated response).</p>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="nl">notification</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">method</span>       <span class="p">:</span> <span class="s1">'chatmessage'</span><span class="p">,</span>
  <span class="nx">data</span>         <span class="p">:</span>
  <span class="p">{</span>
    <span class="nl">foo</span> <span class="p">:</span> <span class="s1">'bar'</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>notification</td>
<td>Must be <code class="prettyprint">true</code>.</td>
</tr>
<tr>
<td>method</td>
<td>A custom string representing the notification method.</td>
</tr>
<tr>
<td>data</td>
<td>An object with custom data.</td>
</tr>
</tbody></table>

<h1 id="protoo-server">protoo-server</h1>

<p><a href='https://npmjs.org/package/protoo-server'><img src='https://img.shields.io/npm/v/protoo-server.svg' alt=''></a></p>

<p>The <strong>protoo</strong> server side Node.js module.</p>

<h2 id="installation">Installation</h2>

<p>Install the <a href="https://www.npmjs.com/package/protoo-server">protoo-server</a> NPM package into your Node.js server side application.</p>
<pre class="highlight shell"><code><span class="gp">$ </span>npm install --save protoo-server
</code></pre>
<h2 id="api">API</h2>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">protooServer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'protoo-server'</span><span class="p">);</span>
</code></pre>
<p>The top-level module exposes:</p>

<ul>
<li><code class="prettyprint">version</code> (String)</li>
<li><code class="prettyprint">WebSocketServer</code> (Class)</li>
<li><code class="prettyprint">Room</code> (Class)</li>
</ul>

<h3 id="version">version</h3>

<p>The package version.</p>

<h3 id="websocketserver">WebSocketServer</h3>

<p>A <code class="prettyprint">WebSocketServer</code> listens for WebSocket connections from clients.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="na">maxReceivedFrameSize</span>     <span class="p">:</span> <span class="mi">960000</span><span class="p">,</span> <span class="c1">// 960 KBytes.</span>
  <span class="na">maxReceivedMessageSize</span>   <span class="p">:</span> <span class="mi">960000</span><span class="p">,</span>
  <span class="na">fragmentOutgoingMessages</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">fragmentationThreshold</span>   <span class="p">:</span> <span class="mi">960000</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">protooServer</span><span class="p">.</span><span class="nx">WebSocketServer</span><span class="p">.</span><span class="nx">Room</span><span class="p">(</span><span class="nx">httpServer</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>httpServer</td>
<td>A Node.js <code class="prettyprint">http.Server</code> or <code class="prettyprint">https.Server</code> object.</td>
</tr>
<tr>
<td>[options]</td>
<td>Options for <a href="https://github.com/theturtle32/WebSocket-Node/blob/master/docs/WebSocketServer.md#server-config-options">websocket.WebSocketServer</a>.</td>
</tr>
</tbody></table>

<aside class='notice'>
It&rsquo;s up to the application to set the <code>http.Server</code> or <code>https.Server</code> and call <code>listen()</code> on it.
<br><br>
In this way, the <code>http.Server</code> or <code>https.Server</code> can also be used for pure HTTP purposes by sharing it with <a href='https://expressjs.com/'>Express</a> or any other Node.js HTTP framework.
</aside>

<h4 id="stop"><code class="prettyprint">stop()</code></h4>

<p>Unmounts the WebSocket server so no more WebSocket connections will take place.</p>

<aside class='notice'>
When <code>stop()</code> is called, the underlying Node.js <code>http.Server</code> or <code>https.Server</code> is not closed.
</aside>

<h4 id="on-connectionrequest-fn-info-accept-reject"><code class="prettyprint">on(&#39;connectionrequest&#39;, fn(info, accept, reject))</code></h4>

<p>Event fired when a WebSocket client attempts to connect to the WebSocket server.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'connectionrequest'</span><span class="p">,</span> <span class="p">(</span><span class="nx">info</span><span class="p">,</span> <span class="nx">accept</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span>
<span class="p">{</span>
  <span class="c1">// The app inspects the `info` object and decides whether to accept the</span>
  <span class="c1">// connection or not.  </span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">something</span> <span class="k">in</span> <span class="nx">info</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">transport</span> <span class="o">=</span> <span class="nx">accept</span><span class="p">();</span>

    <span class="c1">// The app chooses a `peerId` and creates a peer within a specific room.</span>
    <span class="kr">const</span> <span class="nx">peer</span> <span class="o">=</span> <span class="nx">async</span> <span class="nx">room</span><span class="p">.</span><span class="nx">createPeer</span><span class="p">(</span><span class="s1">'bob'</span><span class="p">,</span> <span class="nx">transport</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="nx">reject</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">'Not Allowed'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>info</td>
<td>An object with information about the connection attempt.</td>
</tr>
<tr>
<td>accept</td>
<td>Function to be called if the connection must be accepted.</td>
</tr>
<tr>
<td>reject</td>
<td>Function to be called if the connection must be rejected.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">info</code> object has the following fields:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>request</td>
<td>The Node.js <code class="prettyprint">http.IncomingMessage</code> object representing the received HTTP request during the Websocket handshake.</td>
</tr>
<tr>
<td>origin</td>
<td>The value of the <code class="prettyprint">Origin</code> header in the HTTP request.</td>
</tr>
<tr>
<td>socket</td>
<td>The Node.js <code class="prettyprint">net.Socket</code> object.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">accept</code> function returns a <code class="prettyprint">WebSocketTransport</code> instance.</p>

<p>The <code class="prettyprint">reject</code> function has the following parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>code</td>
<td>403</td>
<td>The HTTP response status code.</td>
</tr>
<tr>
<td>[reason]</td>
<td>&lsquo;Rejected&rsquo;</td>
<td>The HTTP response status reason string.</td>
</tr>
</tbody></table>

<p>or:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>error</td>
<td></td>
<td>An <code class="prettyprint">Error</code> instance.</td>
</tr>
</tbody></table>

<h3 id="websockettransport">WebSocketTransport</h3>

<p>Created when calling <code class="prettyprint">accept()</code> within the <code class="prettyprint">connectionrequest</code> event of the <code class="prettyprint">WebSocketServer</code>. It represents an established WebSocket connection with a client.</p>

<p>No public API is exposed.</p>

<h3 id="room">Room</h3>

<p>A <code class="prettyprint">Room</code> represents a multi-party communication context.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">room</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">protooServer</span><span class="p">.</span><span class="nx">Room</span><span class="p">();</span>
</code></pre>
<h4 id="peers"><code class="prettyprint">peers</code></h4>

<p>Returns an array with all the connected <code class="prettyprint">Peer</code> instances in the room.</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">peer</span> <span class="nx">of</span> <span class="nx">room</span><span class="p">.</span><span class="nx">peers</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'peer id: %s'</span><span class="p">,</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<h4 id="closed"><code class="prettyprint">closed</code></h4>

<p>Boolean indicating whether the room is closed.</p>

<h4 id="async-createpeer-peerid-transport"><code class="prettyprint">async createPeer(peerId, transport)</code></h4>

<p>Creates a <code class="prettyprint">Peer</code> within this room. It resolves to the <code class="prettyprint">Peer</code> instance. It rejects if wrong parameters are given or if there is already a peer with the same <code class="prettyprint">peerId</code> in the room.</p>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">peer</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">room</span><span class="p">.</span><span class="nx">createPeer</span><span class="p">(</span><span class="s1">'alice'</span><span class="p">,</span> <span class="nx">transport</span><span class="p">);</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>peerId</td>
<td>Unique string identifier for the peer.</td>
</tr>
<tr>
<td>transport</td>
<td>A <code class="prettyprint">WebSocketTransport</code> instance.</td>
</tr>
</tbody></table>

<h4 id="haspeer-peerid"><code class="prettyprint">hasPeer(peerId)</code></h4>

<p>Returns <code class="prettyprint">true</code> if there is a peer in the room with the given <code class="prettyprint">peerId</code>.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>peerId</td>
<td>Peer string identifier.</td>
</tr>
</tbody></table>

<h4 id="getpeer-peerid"><code class="prettyprint">getPeer(peerId)</code></h4>

<p>Returns the <code class="prettyprint">Peer</code> instance with the given <code class="prettyprint">peerId</code>, or <code class="prettyprint">undefined</code> if not present in the room.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>peerId</td>
<td>Peer string identifier.</td>
</tr>
</tbody></table>

<h4 id="close"><code class="prettyprint">close()</code></h4>

<p>Closes the room and emits <code class="prettyprint">close</code> event. All the peers within this room will also be closed and their <code class="prettyprint">close</code> event fired.</p>

<h4 id="on-close-fn"><code class="prettyprint">on(&#39;close&#39;, fn())</code></h4>

<p>Event fired when the room is closed.</p>

<h3 id="peer">Peer</h3>

<p>A <code class="prettyprint">Peer</code> represents a remote client connected to a <code class="prettyprint">Room</code>.</p>

<h4 id="id"><code class="prettyprint">id</code></h4>

<p>Read-only string identifier of the peer.</p>

<h4 id="data"><code class="prettyprint">data</code></h4>

<p>Writable custom object up to the application.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="s1">'bar'</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">peer</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">foo</span><span class="p">);</span>
</code></pre>
<h4 id="closed"><code class="prettyprint">closed</code></h4>

<p>Boolean indicating whether the peer is closed.</p>

<h4 id="async-request-method-data"><code class="prettyprint">async request(method, [data])</code></h4>

<p>Sends a <strong>protoo</strong> request to the peer. It resolves to the <code class="prettyprint">data</code> object of the <strong>protoo</strong> response (if successful) or rejects if an error response is received (or any other kind of error happens).</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">try</span>
<span class="p">{</span>
  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s1">'chicken'</span><span class="p">,</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span> <span class="p">});</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'got response data:'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'request failed:'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>method</td>
<td>Request method string.</td>
</tr>
<tr>
<td>[data]</td>
<td>Request data object.</td>
</tr>
</tbody></table>

<h4 id="async-notify-method-data"><code class="prettyprint">async notify(method, [data])</code></h4>

<p>Sends a <strong>protoo</strong> notification to the peer. It resolves if the notification was correctly sent, and rejects if the notification could not be sent.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">'lalala'</span><span class="p">,</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span> <span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>method</td>
<td>Notification method string.</td>
</tr>
<tr>
<td>[data]</td>
<td>Notification data object.</td>
</tr>
</tbody></table>

<h4 id="close"><code class="prettyprint">close()</code></h4>

<p>Closes the peer and its underlying transport, and emits <code class="prettyprint">close</code> event.</p>

<h4 id="on-request-fn-request-accept-reject"><code class="prettyprint">on(&#39;request&#39;, fn(request, accept, reject))</code></h4>

<p>Event fired when a <strong>protoo</strong> request is received from the peer.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">accept</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">something</span> <span class="k">in</span> <span class="nx">request</span><span class="p">)</span>
    <span class="nx">accept</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span> <span class="p">});</span>
  <span class="k">else</span>
    <span class="nx">reject</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">'Not Here'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>request</td>
<td>A <strong>protoo</strong> request.</td>
</tr>
<tr>
<td>accept</td>
<td>Function to be called if the request must be accepted.</td>
</tr>
<tr>
<td>reject</td>
<td>Function to be called if the request must be rejected.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">accept</code> function has the following parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>[data]</td>
<td><code class="prettyprint">{}</code></td>
<td>The <code class="prettyprint">data</code> object field of the response.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">reject</code> function has the following parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>errorCode</td>
<td></td>
<td>Error numeric code.</td>
</tr>
<tr>
<td>[errorReason]</td>
<td></td>
<td>Error text description.</td>
</tr>
</tbody></table>

<p>or:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>error</td>
<td></td>
<td>An <code class="prettyprint">Error</code> instance.</td>
</tr>
</tbody></table>

<h4 id="on-notification-fn-notification"><code class="prettyprint">on(&#39;notification&#39;, fn(notification))</code></h4>

<p>Event fired when a <strong>protoo</strong> notification is received from the peer.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'notification'</span><span class="p">,</span> <span class="p">(</span><span class="nx">notification</span><span class="p">)</span> <span class="o">=&gt;</span>
<span class="p">{</span>
  <span class="c1">// Do something.</span>
<span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>notification</td>
<td>A <strong>protoo</strong> notification.</td>
</tr>
</tbody></table>

<h4 id="on-close-fn"><code class="prettyprint">on(&#39;close&#39;, fn())</code></h4>

<p>Event fired when the peer is closed by calling <code class="prettyprint">close()</code> on it, or when the underlying transport is remotely closed, or when the room is closed.</p>

<h1 id="protoo-client">protoo-client</h1>

<p><a href='https://npmjs.org/package/protoo-client'><img src='https://img.shields.io/npm/v/protoo-client.svg' alt=''></a></p>

<p>The <strong>protoo</strong> client side JavaScript library. It runs in both browser and Node.js environments.</p>

<h2 id="installation">Installation</h2>

<p>Install the <a href="https://www.npmjs.com/package/protoo-client">protoo-client</a> NPM package into your client side application.</p>
<pre class="highlight shell"><code><span class="gp">$ </span>npm install --save protoo-client
</code></pre>
<h2 id="api">API</h2>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">protooClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'protoo-client'</span><span class="p">);</span>
</code></pre>
<p>The top-level module exposes two JavaScript classes:</p>

<ul>
<li><code class="prettyprint">version</code> (String)</li>
<li><code class="prettyprint">WebSocketTransport</code> (Class)</li>
<li><code class="prettyprint">Peer</code> (Class)</li>
</ul>

<h3 id="version">version</h3>

<p>The package version.</p>

<h3 id="websockettransport">WebSocketTransport</h3>

<p>A <code class="prettyprint">WebSocketTransport</code> creates a WebSocket connection.</p>
<pre class="highlight javascript tab-javascript"><code>
<span class="kr">const</span> <span class="nx">transport</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">protooClient</span><span class="p">.</span><span class="nx">WebSocketTransport</span><span class="p">(</span><span class="s1">'wss://example.org'</span><span class="p">);</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>url</td>
<td>WebSocket connection URL.</td>
</tr>
<tr>
<td>[options]</td>
<td>Includes the options for <a href="https://github.com/theturtle32/WebSocket-Node/blob/master/docs/W3CWebSocket.md#constructor">websocket.W3CWebSocket</a> (all but <code class="prettyprint">requestUrl</code>) plus a <code class="prettyprint">retry</code> parameter (see below).</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">retry</code> parameters matches the <code class="prettyprint">options</code> object given to <a href="https://www.npmjs.com/package/retry#retryoperationoptions"><code class="prettyprint">retry.operation()</code></a> and controls the connection and reconnection attempts.</p>

<blockquote>
<p>If <code class="prettyprint">options.retry</code> is not given, it defaults to the following values</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
  <span class="nl">retries</span>    <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">factor</span>     <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nx">minTimeout</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="nx">maxTimeout</span> <span class="p">:</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">1000</span>
<span class="p">};</span>
</code></pre>
<aside class='notice'>
The <code>options</code> parameters other than `retry` are just valid when using <strong>protoo-client</strong> in Node.js.
</aside>

<h3 id="peer">Peer</h3>

<p>A <code class="prettyprint">Peer</code> represents a participant in a remote room.</p>
<pre class="highlight javascript tab-javascript"><code>
<span class="kr">const</span> <span class="nx">peer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">protooClient</span><span class="p">.</span><span class="nx">Peer</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>transport</td>
<td>A <code class="prettyprint">WebSocketTransport</code> instance.</td>
</tr>
</tbody></table>

<h4 id="data"><code class="prettyprint">data</code></h4>

<p>Writable custom object up to the application.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">peer</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">bar</span><span class="p">);</span>
</code></pre>
<h4 id="closed"><code class="prettyprint">closed</code></h4>

<p>Boolean indicating whether the peer is closed.</p>

<h4 id="connected"><code class="prettyprint">connected</code></h4>

<p>Boolean indicating whether the peer is connected.</p>

<h4 id="async-request-method-data"><code class="prettyprint">async request(method, [data])</code></h4>

<p>Sends a <strong>protoo</strong> request to the peer. It resolves to the <code class="prettyprint">data</code> object of the <strong>protoo</strong> response (if successful) or rejects if an error response is received (or any other kind of error happens).</p>
<pre class="highlight javascript tab-javascript"><code><span class="k">try</span>
<span class="p">{</span>
  <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">peer</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s1">'chicken'</span><span class="p">,</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span> <span class="p">});</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'got response data:'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span>
<span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'request failed:'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>method</td>
<td>Request method string.</td>
</tr>
<tr>
<td>[data]</td>
<td>Request data object.</td>
</tr>
</tbody></table>

<h4 id="async-notify-method-data"><code class="prettyprint">async notify(method, [data])</code></h4>

<p>Sends a <strong>protoo</strong> notification to the peer. It resolves if the notification was correctly sent, and rejects if the notification could not be sent.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">'lalala'</span><span class="p">,</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span> <span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>method</td>
<td>Notification method string.</td>
</tr>
<tr>
<td>[data]</td>
<td>Notification data object.</td>
</tr>
</tbody></table>

<h4 id="close"><code class="prettyprint">close()</code></h4>

<p>Closes the peer and its underlying transport, and emits <code class="prettyprint">close</code> event.</p>

<h4 id="on-open-fn"><code class="prettyprint">on(&#39;open&#39;, fn())</code></h4>

<p>Event fired when the transport is connected.</p>

<h4 id="on-failed-fn-currentattempt"><code class="prettyprint">on(&#39;failed&#39;, fn(currentAttempt))</code></h4>

<p>Event fired when the connection with the server fails (due to network errors, not running server, unreachable server address, etc).</p>

<p>The peer will try to connect as many times as defined in its <code class="prettyprint">retry</code> options. After those retries, the <code class="prettyprint">close</code> event will fire.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>currentAttempt</td>
<td>Reconnection attempt (starts with 1).</td>
</tr>
</tbody></table>

<h4 id="on-disconnected-fn"><code class="prettyprint">on(&#39;disconnected&#39;, fn())</code></h4>

<p>Event fired when the established connection is abruptly closed. The peer will start the reconnection procedures as defined in its <code class="prettyprint">retry</code> options.</p>

<p>The peer will try to reconnect as many times as defined in its <code class="prettyprint">retry</code> options. After those retries the <code>close</code> event will fire.</p>

<aside class='notice'>
If <code>close()</code> was called in the server-side <code>room</code>, in the server-side <code>peer</code> or in this client-side <code>peer</code>, no reconnection attempts will take place.
</aside>

<h4 id="on-close-fn"><code class="prettyprint">on(&#39;close&#39;, fn())</code></h4>

<p>Event fired when the peer is closed by calling <code class="prettyprint">close()</code> on it, or when the underlying transport is remotely closed (via <code class="prettyprint">room.close()</code> or <code class="prettyprint">peer.close()</code> in server-side), or after all reconnection attempts fail.</p>

<h4 id="on-request-fn-request-accept-reject"><code class="prettyprint">on(&#39;request&#39;, fn(request, accept, reject))</code></h4>

<p>Event fired when a <strong>protoo</strong> request is received from the room.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'request'</span><span class="p">,</span> <span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">accept</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">something</span> <span class="k">in</span> <span class="nx">request</span><span class="p">)</span>
    <span class="nx">accept</span><span class="p">({</span> <span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span> <span class="p">});</span>
  <span class="k">else</span>
    <span class="nx">reject</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s1">'Not Here'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>request</td>
<td>A <strong>protoo</strong> request.</td>
</tr>
<tr>
<td>accept</td>
<td>Function to be called if the request must be accepted.</td>
</tr>
<tr>
<td>reject</td>
<td>Function to be called if the request must be rejected.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">accept</code> function has the following parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>[data]</td>
<td><code class="prettyprint">{}</code></td>
<td>The <code class="prettyprint">data</code> object field of the response.</td>
</tr>
</tbody></table>

<p>The <code class="prettyprint">reject</code> function has the following parameters:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>errorCode</td>
<td></td>
<td>Error numeric code.</td>
</tr>
<tr>
<td>[errorReason]</td>
<td></td>
<td>Error text description.</td>
</tr>
</tbody></table>

<p>or:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>error</td>
<td></td>
<td>An <code class="prettyprint">Error</code> instance.</td>
</tr>
</tbody></table>

<h4 id="on-notification-fn-notification"><code class="prettyprint">on(&#39;notification&#39;, fn(notification))</code></h4>

<p>Event fired when a <strong>protoo</strong> notification is received from the room.</p>
<pre class="highlight javascript tab-javascript"><code><span class="nx">peer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'notification'</span><span class="p">,</span> <span class="p">(</span><span class="nx">notification</span><span class="p">)</span> <span class="o">=&gt;</span>
<span class="p">{</span>
  <span class="c1">// Do something.</span>
<span class="p">});</span>
</code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>notification</td>
<td>A <strong>protoo</strong> notification.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
